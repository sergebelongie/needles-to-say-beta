let puzzles = [];
let currentPuzzle = null;
let startTime = null;
let endTime = null;

fetch('data.csv')
    .then(response => response.text())
    .then(data => {
        let rows = data.split('\n').slice(1); // Removing header
        rows.forEach(row => {
            let [clue, word1, word2] = row.split(',');
            puzzles.push({clue, word1, word2});
        });

        // Load today's puzzle by default
        loadPuzzleForToday();
    });

function loadPuzzleForToday() {
    let dayNumber = getDayNumberSinceStart(new Date());
    currentPuzzle = puzzles[dayNumber % puzzles.length];
    document.getElementById('clue').textContent = currentPuzzle.clue;
    startTime = new Date();
}

function loadPuzzleForDate() {
    let selectedDate = new Date(document.getElementById('puzzleDate').value);
    let dayNumber = getDayNumberSinceStart(selectedDate);
    currentPuzzle = puzzles[dayNumber % puzzles.length];
    document.getElementById('clue').textContent = currentPuzzle.clue;
}

function getDayNumberSinceStart(date) {
    const start = new Date('2023-07-30');
    const diffTime = Math.abs(date - start);
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
}

function submitGuess() {
    endTime = new Date();
    let playerGuess = document.getElementById('playerInput').value.trim().toLowerCase();

    if (playerGuess === (currentPuzzle.word1 + " " + currentPuzzle.word2).toLowerCase()) {
        document.getElementById('feedback').textContent = "Correct!";
        document.getElementById('socialShare').style.display = "block";
    } else {
        document.getElementById('feedback').textContent = "Try again!";
    }
}

function checkForEnter(event) {
    if (event.keyCode === 13) {
        submitGuess();
    }
}

function copyToClipboard() {
    const elapsedSeconds = Math.floor((endTime - startTime) / 1000);
    const mins = Math.floor(elapsedSeconds / 60);
    const secs = elapsedSeconds % 60;
    const timeStr = `${mins}:${secs.toString().padStart(2, '0')}`;
    const dayNumber = getDayNumberSinceStart(new Date());
    const text = `Needles to Say #${dayNumber} ${timeStr}`;

    const tempInput = document.createElement('textarea');
    tempInput.value = text;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    alert('Text copied to clipboard!');
}
